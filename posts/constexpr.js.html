<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><link rel="icon" href="/favicon.ico" sizes="32x32" type="image/x-icon"><meta name="viewport" content="width=device-width, min-width=800"><link rel="stylesheet" href="/static/css/global_styles.css"><link rel="stylesheet" href="/static/css/prism.css"><title>Zero Cost Abstractions in Web Development</title></head><body><nav><a href="/">
              HOME
          </a><a href="/projects.html">
              PROJECTS
          </a><a href="/tags.html">
              TAGS
          </a></nav>
<img class="bg" id="main_bg" src="/static/img/bg.jpg"><img class="bg" id="null" src="/static/img/stones.jpg" style="opacity: 0; filter: none; object-position: left center;"><article>
    <header><h3 id="main_title">Zero Cost Abstractions in Web Development</h3></header><ul class="tags_list"><li><a class="tag_element" href="/tags/constexpr.js.html">constexpr.js</a></li><li><a class="tag_element" href="/tags/web.html">web</a></li></ul><div style="width: 100%; height: 5px; margin: 1em 0 2em; border: solid black; border-width: 1px 0;"></div><p>
        In this article I'm going to talk about <a href="https://github.com/fctorial/ConstexprJS">constexpr.js</a>, which is a tool
        that allows you to use zero cost abstractions when developing websites.
    </p>
    <h4>What is constexpr?</h4>
    <p>
        Constexpr is a feature found in statically compiled programming languages that allows evaluation of expressions a
        program at compile time. Different languages have use different terminology for it. For example,
        in zig lang, it's called <progi>comptime</progi>. Common lisp macros, in lisps that compile to native code, might
        also be grouped in this category.
    </p>
    <p>
        This allows automatic generation of complex static data at compile time, and the runtime code can just use the
        result of that compile time evaluated data. Variable inlining is a simple form of compile time evaluation.<br>
        Ideally, the language/compiler should make it possible to turn any eligible piece of code "constexpr" with some
        annotations. The eligibility criteria being that the code must not depend on any runtime data.
    </p>
    <h4>What is constexpr.js?</h4>
    <p>
        <a href="https://github.com/fctorial/ConstexprJS">constexpr.js</a> is a static site generator. It's different
        from SSG's like Jakyll in that it doesn't force you to learn a dedicated domain specific language. There already exists a
        dedicated languages for dealing with DOM and websites, javascript. With constexpr.js, you use javascript and usual
        DOM manipulation methods to generate the website. The whole browser runtime is available at your disposal when
        generating sites with constexpr.js.
    </p>

    <h4>Demo</h4>
    <p>This whole website is built using constexpr.js.</p>

    <h4>How does it work?</h4>
    <p>
        The compiler renders the pages using chrome, and once they finish rendering, it saves the rendered state
        as new pages. It also strips the constexpr javascript out, potentially reducing download size for the website users
        drastically. Any piece of javascript code that just generates some html can be made constexpr.
    </p>
    <p>
        The generated pages don't have to be completely static. For example, try hovering over the images on <a href="/posts/intellij_logos.html">this</a> page.
    </p>
    <blockquote>These new pages will look exactly like the original pages after they finish rendering. This is one of the
        basic principles of constexpr.js. So you can keep building your website as usual and run the compiler once
        you're happy with the results, and you'll get a leaner, faster version of your website as output.</blockquote>

    <h4>How to use it?</h4>

    <p>
        You will have to divide the javascript being used in your page into two groups. Runtime javascript and
        compile time javascript, and annotate all compile time script tags with
        <progi>constexpr</progi>
        attribute:
        <prog class=" language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">constexpr</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token operator">...</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">constexpr</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/generate_page.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span></prog>
        <br>
        Runtime code must not depend on the compile time code, since that code will be stripped out before writing the
        output file.
        See <a href="/posts/runtime_compiletime_constexpr.js.html">this guide</a> for code organization
        tips for constexpr.js.
    </p>

    <p>
        Once the HTML generation code has finished rendering, it must call the
        <progi>window._ConstexprJS_.compile()</progi>
        function. This function is injected into the page by the compiler.
    </p>

    <p>
        The compiler can be installed like this:
        <prog class=" language-bash"><span class="token function">npm</span> i -g constexpr.js</prog>
        <br>
    </p>

    <p>
        Command line usage:
        <prog class=" language-bash">constexpr.js --input<span class="token operator">=</span><span class="token string">"&lt;input_directory&gt;"</span> --output<span class="token operator">=</span><span class="token string">"&lt;output_directory&gt;"</span> <span class="token punctuation">[</span>--exclusions<span class="token operator">=</span>path1:path2<span class="token punctuation">]</span> <span class="token punctuation">[</span>--verbose<span class="token punctuation">]</span> <span class="token punctuation">[</span>--jobs<span class="token operator">=</span>n<span class="token punctuation">]</span> <span class="token punctuation">[</span>--noheadless<span class="token punctuation">]</span> <span class="token punctuation">[</span>--jobtimeout<span class="token punctuation">]</span> <span class="token punctuation">[</span>--depfile<span class="token operator">=</span><span class="token operator">&lt;</span>depfile<span class="token operator">&gt;</span><span class="token punctuation">]</span></prog>
    </p>
    <p>
        This is what an invocation looks like:
    </p>
    <div id="asciinema_cont">
        <asciinema-player speed="100" rows="136" src="/static/files/build.cast"><div data-reactroot="" tabindex="-1" class="asciinema-player-wrapper"><div class="asciinema-player asciinema-theme-asciinema"><pre class="asciinema-terminal font-small" style="width: 265ch; height: 181.333em;"><span class="line"><span class="fg-10 bright">~/src/fctorial.github.io.src</span><span> </span></span><span class="line"><span class="fg-4">$ </span><span class="fg-2">./build.sh</span><span> </span></span><span class="line"><span>Using port:------------------------------------------------- 9046 </span></span><span class="line"><span>Found path:------------------------------------------------- /404.html </span></span><span class="line"><span>Found path:------------------------------------------------- /_template.html </span></span><span class="line"><span>Found path:------------------------------------------------- /index.html </span></span><span class="line"><span>Found path:------------------------------------------------- /posts/constexpr.js.html </span></span><span class="line"><span>Found path:------------------------------------------------- /posts/constexprjs_generator_pages.html </span></span><span class="line"><span>Found path:------------------------------------------------- /posts/intellij_logos.html </span></span><span class="line"><span>Found path:------------------------------------------------- /posts/modifying_idea.html </span></span><span class="line"><span>Found path:------------------------------------------------- /posts/runtime_compiletime_constexpr.js.html </span></span><span class="line"><span>Found path:------------------------------------------------- /posts/zircon_standalone.html </span></span><span class="line"><span>Found path:------------------------------------------------- /projects.html </span></span><span class="line"><span class="fg-226 bright">Ignoring path:---------------------------------------------- /tags/generator.html</span><span> </span></span><span class="line"><span>Found path:------------------------------------------------- /tags.html </span></span><span class="line"><span>Using job count:-------------------------------------------- 5 </span></span><span class="line"><span>Using job timeout:------------------------------------------ 999999999 </span></span><span class="line"><span class="fg-135">Queued file #1:--------------------------------------------- /404.html</span><span> </span></span><span class="line"><span class="fg-111">Queued file #2:--------------------------------------------- /_template.html</span><span> </span></span><span class="line"><span class="fg-135">Queued file #3:--------------------------------------------- /index.html</span><span> </span></span><span class="line"><span class="fg-132">Queued file #4:--------------------------------------------- /posts/constexpr.js.html</span><span> </span></span><span class="line"><span class="fg-110">Queued file #5:--------------------------------------------- /posts/constexprjs_generator_pages.html</span><span> </span></span><span class="line"><span class="fg-226 bright">Page /_template.html signalled an abortion, message:-------- "is a template"</span><span> </span></span><span class="line"><span class="fg-111">(1/11) (abortion):------------------------------------------ /_template.html</span><span> </span></span><span class="line"><span class="fg-175">Queued file #6:--------------------------------------------- /posts/intellij_logos.html</span><span> </span></span><span class="line"><span class="fg-110">(2/11) Finished:-------------------------------------------- /posts/constexprjs_generator_pages.html</span><span> </span></span><span class="line"><span class="fg-180">Queued file #7:--------------------------------------------- /posts/modifying_idea.html</span><span> </span></span><span class="line"><span class="fg-135">(3/11) Finished:-------------------------------------------- /404.html</span><span> </span></span><span class="line"><span class="fg-113">Queued file #8:--------------------------------------------- /posts/runtime_compiletime_constexpr.js.html</span><span> </span></span><span class="line"><span class="fg-135">(4/11) Finished:-------------------------------------------- /index.html</span><span> </span></span><span class="line"><span class="fg-78">Queued file #9:--------------------------------------------- /posts/zircon_standalone.html</span><span> </span></span><span class="line"><span class="fg-175">(5/11) Finished:-------------------------------------------- /posts/intellij_logos.html</span><span> </span></span><span class="line"><span class="fg-113">Queued file #10:-------------------------------------------- /projects.html</span><span> </span></span><span class="line"><span class="fg-113">(6/11) Finished:-------------------------------------------- /projects.html</span><span> </span></span><span class="line"><span class="fg-141">Queued file #11:-------------------------------------------- /tags.html</span><span> </span></span><span class="line"><span class="fg-180">(7/11) Finished:-------------------------------------------- /posts/modifying_idea.html</span><span> </span></span><span class="line"><span class="fg-113">(8/11) Finished:-------------------------------------------- /posts/runtime_compiletime_constexpr.js.html</span><span> </span></span><span class="line"><span class="fg-78">(9/11) Finished:-------------------------------------------- /posts/zircon_standalone.html</span><span> </span></span><span class="line"><span>/tags.html added extra path /tags/intellij.html to be generated using /tags/generator.html?intellij </span></span><span class="line"><span>/tags.html added extra path /tags/constexpr.js.html to be generated using /tags/generator.html?constexpr.js </span></span><span class="line"><span>/tags.html added extra path /tags/javascript.html to be generated using /tags/generator.html?javascript </span></span><span class="line"><span>/tags.html added extra path /tags/zircon_standalone.html to be generated using /tags/generator.html?zircon_standalone </span></span><span class="line"><span class="fg-141">(10/15) Finished:------------------------------------------- /tags.html</span><span> </span></span><span class="line"><span class="fg-115">Queued file #12:-------------------------------------------- /tags/intellij.html</span><span> </span></span><span class="line"><span class="fg-150">Queued file #13:-------------------------------------------- /tags/constexpr.js.html</span><span> </span></span><span class="line"><span class="fg-113">Queued file #14:-------------------------------------------- /tags/javascript.html</span><span> </span></span><span class="line"><span class="fg-84">Queued file #15:-------------------------------------------- /tags/zircon_standalone.html</span><span> </span></span><span class="line"><span class="fg-132">(11/15) Finished:------------------------------------------- /posts/constexpr.js.html</span><span> </span></span><span class="line"><span class="fg-115">(12/15) Finished:------------------------------------------- /tags/intellij.html</span><span> </span></span><span class="line"><span class="fg-150">(13/15) Finished:------------------------------------------- /tags/constexpr.js.html</span><span> </span></span><span class="line"><span class="fg-84">(14/15) Finished:------------------------------------------- /tags/zircon_standalone.html</span><span> </span></span><span class="line"><span class="fg-113">(15/15) Finished:------------------------------------------- /tags/javascript.html</span><span> </span></span><span class="line"><span>Copying resource:------------------------------------------- /static/css/global_styles.css </span></span><span class="line"><span class="fg-226 bright">Excluding resource:----------------------------------------- /collections/posts.json</span><span> </span></span><span class="line"><span>Copying resource:------------------------------------------- /static/css/prism.css </span></span><span class="line"><span class="fg-226 bright">Excluding resource:----------------------------------------- /static/js/constexpr/third_party/prism.js</span><span> </span></span><span class="line"><span>Copying resource:------------------------------------------- /static/img/bg.jpg </span></span><span class="line"><span class="fg-226 bright">Excluding resource:----------------------------------------- /collections/nav.json</span><span> </span></span><span class="line"><span class="fg-226 bright">Excluding resource:----------------------------------------- /collections/intellij_logos.json</span><span> </span></span><span class="line"><span>Copying resource:------------------------------------------- /static/img/intellij_logos/2009.09.01.png </span></span><span class="line"><span>Copying resource:------------------------------------------- /static/img/intellij_logos/2009.09.09.png </span></span><span class="line"><span>Copying resource:------------------------------------------- /static/img/intellij_logos/2009.09.13.png </span></span><span class="line"><span>Copying resource:------------------------------------------- /static/img/intellij_logos/2009.11.03.png </span></span><span class="line"><span>Copying resource:------------------------------------------- /static/img/intellij_logos/2010.00.11.png </span></span><span class="line"><span>Copying resource:------------------------------------------- /static/img/intellij_logos/2010.06.22.png </span></span><span class="line"><span>Copying resource:------------------------------------------- /static/img/intellij_logos/2010.10.16.png </span></span><span class="line"><span>Copying resource:------------------------------------------- /static/img/intellij_logos/2010.10.30.png </span></span><span class="line"><span>Copying resource:------------------------------------------- /static/img/intellij_logos/2011.00.14.png </span></span><span class="line"><span>Copying resource:------------------------------------------- /static/img/intellij_logos/2011.06.19.png </span></span><span class="line"><span>Copying resource:------------------------------------------- /static/img/intellij_logos/2011.06.22.png </span></span><span class="line"><span>Copying resource:------------------------------------------- /static/img/intellij_logos/2011.08.05.png </span></span><span class="line"><span>Copying resource:------------------------------------------- /static/img/intellij_logos/2011.10.15.png </span></span><span class="line"><span>Copying resource:------------------------------------------- /static/img/intellij_logos/2011.11.01.png </span></span><span class="line"><span>Copying resource:------------------------------------------- /static/img/intellij_logos/2012.00.10.png </span></span><span class="line"><span>Copying resource:------------------------------------------- /static/img/intellij_logos/2012.03.23.png </span></span><span class="line"><span>Copying resource:------------------------------------------- /static/img/intellij_logos/2012.05.27.png </span></span><span class="line"><span>Copying resource:------------------------------------------- /static/img/intellij_logos/2012.10.07.png </span></span><span class="line"><span>Copying resource:------------------------------------------- /static/img/intellij_logos/2012.10.28.png </span></span><span class="line"><span>Copying resource:------------------------------------------- /static/img/intellij_logos/2012.10.30.png </span></span><span class="line"><span>Copying resource:------------------------------------------- /static/img/intellij_logos/2012.11.26.png </span></span><span class="line"><span>Copying resource:------------------------------------------- /static/img/intellij_logos/2013.00.14.png </span></span><span class="line"><span>Copying resource:------------------------------------------- /static/img/intellij_logos/2013.04.15.png </span></span><span class="line"><span>Copying resource:------------------------------------------- /static/img/intellij_logos/2013.04.22.png </span></span><span class="line"><span>Copying resource:------------------------------------------- /static/img/intellij_logos/2013.10.04.png </span></span><span class="line"><span>Copying resource:------------------------------------------- /static/img/intellij_logos/2013.10.27.png </span></span><span class="line"><span>Copying resource:------------------------------------------- /static/img/intellij_logos/2014.00.21.png </span></span><span class="line"><span>Copying resource:------------------------------------------- /static/img/intellij_logos/2014.01.07.png </span></span><span class="line"><span>Copying resource:------------------------------------------- /static/img/intellij_logos/2014.02.05.png </span></span><span class="line"><span>Copying resource:------------------------------------------- /static/img/intellij_logos/2014.02.11.png </span></span><span class="line"><span>Copying resource:------------------------------------------- /static/img/intellij_logos/2014.03.07.png </span></span><span class="line"><span>Copying resource:------------------------------------------- /static/img/intellij_logos/2014.08.28.png </span></span><span class="line"><span>Copying resource:------------------------------------------- /static/img/intellij_logos/2014.09.20.png </span></span><span class="line"><span>Copying resource:------------------------------------------- /static/img/intellij_logos/2015.03.29.png </span></span><span class="line"><span>Copying resource:------------------------------------------- /static/img/intellij_logos/2015.04.13.png </span></span><span class="line"><span>Copying resource:------------------------------------------- /static/img/intellij_logos/2015.04.19.png </span></span><span class="line"><span>Copying resource:------------------------------------------- /static/img/intellij_logos/2015.08.04.png </span></span><span class="line"><span>Copying resource:------------------------------------------- /static/img/intellij_logos/2015.09.21.png </span></span><span class="line"><span>Copying resource:------------------------------------------- /static/img/intellij_logos/2015.11.03.png </span></span><span class="line"><span>Copying resource:------------------------------------------- /static/img/intellij_logos/2015.11.17.png </span></span><span class="line"><span>Copying resource:------------------------------------------- /static/img/intellij_logos/2016.04.11.png </span></span><span class="line"><span>Copying resource:------------------------------------------- /static/img/intellij_logos/2016.06.19.png </span></span><span class="line"><span>Copying resource:------------------------------------------- /static/img/intellij_logos/2016.11.13.png </span></span><span class="line"><span>Copying resource:------------------------------------------- /static/img/intellij_logos/2017.03.18.png </span></span><span class="line"><span>Copying resource:------------------------------------------- /static/img/intellij_logos/2017.05.26.png </span></span><span class="line"><span>Copying resource:------------------------------------------- /static/img/intellij_logos/2017.05.27.png </span></span><span class="line"><span>Copying resource:------------------------------------------- /static/img/intellij_logos/2017.05.28.png </span></span><span class="line"><span>Copying resource:------------------------------------------- /static/img/intellij_logos/2017.05.30.png </span></span><span class="line"><span>Copying resource:------------------------------------------- /static/img/intellij_logos/2017.08.05.png </span></span><span class="line"><span>Copying resource:------------------------------------------- /static/img/intellij_logos/2017.08.06.png </span></span><span class="line"><span>Copying resource:------------------------------------------- /static/img/intellij_logos/2017.09.24.png </span></span><span class="line"><span>Copying resource:------------------------------------------- /static/img/intellij_logos/2018.00.22.png </span></span><span class="line"><span>Copying resource:------------------------------------------- /static/img/intellij_logos/2018.04.14.png </span></span><span class="line"><span>Copying resource:------------------------------------------- /static/img/intellij_logos/2018.08.08.png </span></span><span class="line"><span>Copying resource:------------------------------------------- /static/img/intellij_logos/2019.00.14.png </span></span><span class="line"><span>Copying resource:------------------------------------------- /static/img/intellij_logos/2019.03.04.png </span></span><span class="line"><span>Copying resource:------------------------------------------- /static/img/intellij_logos/2019.04.07.png </span></span><span class="line"><span>Copying resource:------------------------------------------- /static/img/intellij_logos/2019.04.10.png </span></span><span class="line"><span>Copying resource:------------------------------------------- /static/img/intellij_logos/2019.04.29.png </span></span><span class="line"><span>Copying resource:------------------------------------------- /static/img/intellij_logos/2019.05.08.png </span></span><span class="line"><span>Copying resource:------------------------------------------- /static/img/intellij_logos/2019.05.12.png </span></span><span class="line"><span>Copying resource:------------------------------------------- /static/img/intellij_logos/2019.08.02.png </span></span><span class="line"><span>Copying resource:------------------------------------------- /static/img/intellij_logos/2020.00.21.png </span></span><span class="line"><span>Copying resource:------------------------------------------- /static/img/intellij_logos/2020.04.21.png </span></span><span class="line"><span>Copying resource:------------------------------------------- /static/img/intellij_logos/2020.08.16.png </span></span><span class="line"><span>Copying resource:------------------------------------------- /static/img/intellij_logos/2021.00.21.png </span></span><span class="line"><span class="fg-226 bright">Excluding resource:----------------------------------------- /collections/projects.json</span><span> </span></span><span class="line"><span>Copying resource:------------------------------------------- /static/img/fuchsia.svg </span></span><span class="line"><span>Copying resource:------------------------------------------- /static/css/pivot.css </span></span><span class="line"><span>Copying resource:------------------------------------------- /static/css/asciinema-player.css </span></span><span class="line"><span class="fg-226 bright">Excluding resource:----------------------------------------- /static/files/tips.csv</span><span> </span></span><span class="line"><span class="fg-226 bright">Excluding resource:----------------------------------------- /static/files/build.cast</span><span> </span></span><span class="line"><span class="fg-10 bright">~/src/fctorial.github.io.src</span><span> </span></span><span class="line"><span class="fg-4">$ </span><span class="fg-9 bright"></span><span class="fg-bg bg-fg cursor"> </span><span> </span></span><span class="line"><span> </span></span><span class="line"><span> </span></span><span class="line"><span> </span></span></pre><div class="control-bar"><span class="playback-button"><svg version="1.1" viewBox="0 0 12 12" class="icon"><path d="M1,0 L4,0 L4,12 L1,12 Z"></path><path d="M8,0 L11,0 L11,12 L8,12 Z"></path></svg></span><span class="timer"><span class="time-elapsed">00:09</span><span class="time-remaining">-00:00</span></span><span class="fullscreen-button"><svg version="1.1" viewBox="0 0 12 12" class="icon"><path d="M12,0 L7,0 L9,2 L7,4 L8,5 L10,3 L12,5 Z"></path><path d="M0,12 L0,7 L2,9 L4,7 L5,8 L3,10 L5,12 Z"></path></svg><svg version="1.1" viewBox="0 0 12 12" class="icon"><path d="M7,5 L7,0 L9,2 L11,0 L12,1 L10,3 L12,5 Z"></path><path d="M5,7 L0,7 L2,9 L0,11 L1,12 L3,10 L5,12 Z"></path></svg></span><span class="progressbar"><span class="bar"><span class="gutter"><span style="width: 92.3062%;"></span></span></span></span></div></div></div></asciinema-player>
    </div>
    <p>
        The tool also copies resources (<progi>css</progi>, <progi>images</progi> etcetra)
        that are requested by pages being rendered. HTML files/resources inside paths given in <progi>--exclusions</progi>
        are not processed/copied.
    </p>
    <p>
        A json object with the command line args, compilation results and dependencies will be written to the path specified
        by <progi>--depfile</progi> option.
    </p>

    <h4>Plugins</h4>
    <p>
        You can use any web development technology (and any number of technologies) to generate the html without any
        fear of bloat. Pivottable.js demo:
    </p>
    <div id="pt_output"><table class="pvtTable" data-numrows="4" data-numcols="4"><thead><tr><th colspan="2" rowspan="1"></th><th class="pvtAxisLabel">day</th><th class="pvtColLabel" colspan="1" rowspan="2">Fri</th><th class="pvtColLabel" colspan="1" rowspan="2">Sat</th><th class="pvtColLabel" colspan="1" rowspan="2">Sun</th><th class="pvtColLabel" colspan="1" rowspan="2">Thur</th><th class="pvtTotalLabel pvtRowTotalLabel" rowspan="2">Totals</th></tr><tr><th class="pvtAxisLabel">sex</th><th class="pvtAxisLabel">smoker</th><th></th></tr></thead><tbody><tr><th class="pvtRowLabel" rowspan="2">Female</th><th class="pvtRowLabel" rowspan="1" colspan="2">No</th><td class="pvtVal row0 col0" data-value="6.25" style="background-color: rgb(255, 253, 253);">6.25</td><td class="pvtVal row0 col1" data-value="35.42" style="background-color: rgb(255, 195, 195);">35.42</td><td class="pvtVal row0 col2" data-value="46.61" style="background-color: rgb(255, 173, 173);">46.61</td><td class="pvtVal row0 col3" data-value="61.49" style="background-color: rgb(255, 143, 143);">61.49</td><td class="pvtTotal rowTotal" data-value="149.77" data-for="row0" style="background-color: rgb(255, 189, 189);">149.77</td></tr><tr><th class="pvtRowLabel" rowspan="1" colspan="2">Yes</th><td class="pvtVal row1 col0" data-value="18.78" style="background-color: rgb(255, 228, 228);">18.78</td><td class="pvtVal row1 col1" data-value="43.03000000000001" style="background-color: rgb(255, 180, 180);">43.03</td><td class="pvtVal row1 col2" data-value="14" style="background-color: rgb(255, 237, 237);">14.00</td><td class="pvtVal row1 col3" data-value="20.930000000000003" style="background-color: rgb(255, 224, 224);">20.93</td><td class="pvtTotal rowTotal" data-value="96.74" data-for="row1" style="background-color: rgb(255, 255, 255);">96.74</td></tr><tr><th class="pvtRowLabel" rowspan="2">Male</th><th class="pvtRowLabel" rowspan="1" colspan="2">No</th><td class="pvtVal row2 col0" data-value="5" style="background-color: rgb(255, 255, 255);">5.00</td><td class="pvtVal row2 col1" data-value="104.21000000000001" style="background-color: rgb(255, 59, 59);">104.21</td><td class="pvtVal row2 col2" data-value="133.96000000000004" style="background-color: rgb(255, 0, 0);">133.96</td><td class="pvtVal row2 col3" data-value="58.83" style="background-color: rgb(255, 149, 149);">58.83</td><td class="pvtTotal rowTotal" data-value="302" data-for="row2" style="background-color: rgb(255, 0, 0);">302.00</td></tr><tr><th class="pvtRowLabel" rowspan="1" colspan="2">Yes</th><td class="pvtVal row3 col0" data-value="21.93" style="background-color: rgb(255, 222, 222);">21.93</td><td class="pvtVal row3 col1" data-value="77.73999999999998" style="background-color: rgb(255, 111, 111);">77.74</td><td class="pvtVal row3 col2" data-value="52.82" style="background-color: rgb(255, 160, 160);">52.82</td><td class="pvtVal row3 col3" data-value="30.58" style="background-color: rgb(255, 204, 204);">30.58</td><td class="pvtTotal rowTotal" data-value="183.07" data-for="row3" style="background-color: rgb(255, 148, 148);">183.07</td></tr><tr><th class="pvtTotalLabel pvtColTotalLabel" colspan="3">Totals</th><td class="pvtTotal colTotal" data-value="51.96" data-for="col0" style="background-color: rgb(255, 255, 255);">51.96</td><td class="pvtTotal colTotal" data-value="260.4" data-for="col1" style="background-color: rgb(255, 0, 0);">260.40</td><td class="pvtTotal colTotal" data-value="247.39000000000007" data-for="col2" style="background-color: rgb(255, 16, 16);">247.39</td><td class="pvtTotal colTotal" data-value="171.83" data-for="col3" style="background-color: rgb(255, 108, 108);">171.83</td><td class="pvtGrandTotal" data-value="731.58">731.58</td></tr></tbody></table></div>
    <p>
        This page also uses prism.js for syntax highlighting and asciinema-player for the
        <progi>./build.sh</progi> output, along with jquery and papaparse. A total of 1.1mb of javascript that you don't
        have to download because it's constexpr.<br>
    </p>
    <h4>Notes</h4>

    <ol>
        <li>
            You can mark tags other than <progi>script</progi> with <progi>constexpr</progi> as well.
            In the above example, the box at the top is marked constexpr, so it isn't present in the output page.
            This can be used to differentiate original website from generated website:
            <prog class=" language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">constexpr</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
<span class="token selector">body</span> <span class="token punctuation">{</span>
    <span class="token property">border</span><span class="token punctuation">:</span> 2px solid red<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span></prog>
            This code will add a red border to your page which will only appear on the original website.
        </li>
        <li>
            Client code in the page can signal the compiler to skip the current file by calling
            <progi>window._ConstexprJS_.abort(message)</progi>.
        </li>
        <li>
            In the original webpage, you'll see a console error when the code tries to call the compilation trigger
            functions,
            since those functions are injected by the compiler. You can add this snippet near the top to fix that error:

            <prog class=" language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">constexpr</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>window<span class="token punctuation">.</span>_ConstexprJS_<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    window<span class="token punctuation">.</span>_ConstexprJS_ <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token function-variable function">compile</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">abort</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">addPaths</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span></prog>
        </li>
        <li>
            There might be multiple rendering tasks running in your page. You can manage them using promises:
            <prog class=" language-js">Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token function">render_task_1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">render_task_2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> window<span class="token punctuation">.</span>_ConstexprJS_<span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></prog>
        </li>
        <li>
            You should keep all list data separate from the html in <a href="https://github.com/fctorial/fctorial.github.io.src/tree/master/collections">json files</a>.
            <progi>constexpr</progi>
            code in the html will fetch these json files and render the page using them.
            The directory containing this data should be excluded using
            <progi>--exclusions</progi>
            flag, so that the
            resources inside it aren't copied over.
        </li>
        <li>
            You can include dev utilites like <a href="https://github.com/fctorial/fctorial.github.io.src/blob/master/static/js/constexpr/renderer.js#L86">this</a>
            in the
            original website. It reloads the page whenever it's focused. It won't be in the output since it's used as
            constexpr.
        </li>
        <li>
            This whole website is rendered using javascript and constexpr.js. The html files contains only the page
            specific stuff. (article text and page specific styling).
            All of the styling and theming is done by constexpr code. Nothing other than the image background switching
            uses runtime javascript:
            <prog>
$ tokei -t=html
===============================================================================
Language            Files        Lines         Code     Comments       Blanks
===============================================================================
HTML                   16         1072          918            0          154
|- CSS                  6           76           68            0            8
|- JavaScript           2           37           37            0            0
(Total)                           1185         1023            0          162
===============================================================================
Total                  16         1185         1023            0          162
===============================================================================
            </prog>
            The original sources for this website can be found <a href="https://github.com/fctorial/fctorial.github.io.src">here</a>.
        </li>
        <li>
            Use this if you love javascript
        </li>
        <li>
            Use this if you hate javascript
        </li>
    </ol>
    <blockquote>
        See pages tagged with <a class="tag_element" href="/tags/constexpr.js.html">constexpr.js</a> for more guides.
    </blockquote>
</article>


<script>
  function initRT() {
    const bg = document.querySelector('#main_bg')
    const thanos = bg.cloneNode(true)
    thanos.setAttribute('id', null)
    thanos.style.opacity = '0'
    thanos.style.filter = 'none'
    thanos.style['object-position'] = 'left'
    thanos.setAttribute('src', '/static/img/stones.jpg')
    insertAfter(bg, thanos)
    window.onscroll = () => {
      const maxScroll = document.body.offsetHeight - window.innerHeight
      const curScroll = window.scrollY
      if (maxScroll - curScroll < 100) {
        thanos.style.opacity = '1'
        bg.style.opacity = '0'
      } else {
        thanos.style.opacity = '0'
        bg.style.opacity = '1'
      }
    }
  }
</script>





<link rel="stylesheet" type="text/css" href="/static/css/pivot.css">




<link rel="stylesheet" type="text/css" href="/static/css/asciinema-player.css">







<style>
    ol li {
        margin: 2em 0;
    }

    #asciinema_cont {
        width: 100%;
        height: 400px;
        overflow-y: auto;
    }

    asciinema-player .control-bar {
        display: none;
    }

    asciinema-player .asciinema-player {
        overflow-x: auto !important;
    }

</style>

</body></html>