<!DOCTYPE html><html lang="en"><head>
    <title>constexpr.js</title>
<meta charset="UTF-8"><link rel="icon" href="/favicon.png" sizes="420x420" type="image/png"><meta name="viewport" content="width=device-width"><link rel="stylesheet" href="/static/css/global_styles.css"><link rel="stylesheet" href="/static/css/prism.css"></head>
<body>
<nav><a href="/">
              HOME
          </a><a href="/projects.html">
              PROJECTS
          </a></nav><article>
    <header>
        <h3 id="main_title">Constexpr.js</h3>
    </header>
    <h4>What is constexpr.js?</h4>
    <p>
        <a href="https://github.com/fctorial/ConstexprJS">constexpr.js</a> is a static site generator which doesn't force you to learn a domain specific language.
        When using this tool, you use javascript and usual DOM manipulation methods to generate the webpage. The tool
        will render the page using chrome, and once it has finished rendering, it will save the rendered state of the
        page as a new html file. This new html file will look exactly like the original page after it has finished rendering.
        For example, the tool converts <a href="/demos/constexpr.js/input.html">this</a> page into <a href="/demos/constexpr.js/output.html">this</a> page.
        <br>
        The generated page doesn't have to be completely static. In the above example, the heading is being animated
        with javascript.
    </p>

    <h4>How to use it?</h4>

    <p>
        You will have to divide the javascript being used in your page into two groups. Runtime javascript and
        compile time javascript, and annotate all compile time script tags with <progi>constexpr</progi> attribute:
        <prog class=" language-html">
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">constexpr</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token operator">...</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">constexpr</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/generate_page.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
        </prog><br>
        Runtime code must not depend on the compile time code, since that code will be stripped out before writing the output file.
    </p>

    <p>
        Once the HTML generation code has finished rendering, it must call the <progi>window._ConstexprJS_.compile()</progi>
        function. This function is injected into the page by the compiler.
    </p>

    <p>
        The compiler can be installed like this: <prog class=" language-bash"><span class="token function">npm</span> i -g constexpr.js</prog><br>

        Command line usage:
        <prog class=" language-bash">constexpr.js --input<span class="token operator">=</span><span class="token string">"&lt;input_directory&gt;"</span> --output<span class="token operator">=</span><span class="token string">"&lt;output_directory&gt;"</span> <span class="token punctuation">[</span>--exclusions<span class="token operator">=</span>path1:path2<span class="token punctuation">]</span> <span class="token punctuation">[</span>--verbose<span class="token punctuation">]</span> <span class="token punctuation">[</span>--jobs<span class="token operator">=</span>n<span class="token punctuation">]</span> <span class="token punctuation">[</span>--noheadless<span class="token punctuation">]</span> <span class="token punctuation">[</span>--jobtimeout<span class="token punctuation">]</span></prog><br>

        The tool also copies resources (<progi>css</progi>, <progi>images</progi> etcetra)
        that are requested by pages being rendered. HTML files/resources inside paths given in <progi>--exclusions</progi> are not processed/copied.
    </p>

    <h4>Notes</h4>

    <ol>
        <li>
            You can use any web development technology (and any number of technologies) to generate the html without any fear
            of bloat. Just make sure that <progi>window._ConstexprJS_.compile()</progi> is called <span style="font-style: italic;">after</span>
            the page has finished rendering.
            <br>
            <br>
            Pivottable.js demo:
            <br>
            <br>
            <div id="pt_output"><table class="pvtTable" data-numrows="4" data-numcols="4"><thead><tr><th colspan="2" rowspan="1"></th><th class="pvtAxisLabel">day</th><th class="pvtColLabel" colspan="1" rowspan="2">Fri</th><th class="pvtColLabel" colspan="1" rowspan="2">Sat</th><th class="pvtColLabel" colspan="1" rowspan="2">Sun</th><th class="pvtColLabel" colspan="1" rowspan="2">Thur</th><th class="pvtTotalLabel pvtRowTotalLabel" rowspan="2">Totals</th></tr><tr><th class="pvtAxisLabel">sex</th><th class="pvtAxisLabel">smoker</th><th></th></tr></thead><tbody><tr><th class="pvtRowLabel" rowspan="2">Female</th><th class="pvtRowLabel" rowspan="1" colspan="2">No</th><td class="pvtVal row0 col0" data-value="6.25" style="background-color: rgb(255, 253, 253);">6.25</td><td class="pvtVal row0 col1" data-value="35.42" style="background-color: rgb(255, 195, 195);">35.42</td><td class="pvtVal row0 col2" data-value="46.61" style="background-color: rgb(255, 173, 173);">46.61</td><td class="pvtVal row0 col3" data-value="61.49" style="background-color: rgb(255, 143, 143);">61.49</td><td class="pvtTotal rowTotal" data-value="149.77" data-for="row0" style="background-color: rgb(255, 189, 189);">149.77</td></tr><tr><th class="pvtRowLabel" rowspan="1" colspan="2">Yes</th><td class="pvtVal row1 col0" data-value="18.78" style="background-color: rgb(255, 228, 228);">18.78</td><td class="pvtVal row1 col1" data-value="43.03000000000001" style="background-color: rgb(255, 180, 180);">43.03</td><td class="pvtVal row1 col2" data-value="14" style="background-color: rgb(255, 237, 237);">14.00</td><td class="pvtVal row1 col3" data-value="20.930000000000003" style="background-color: rgb(255, 224, 224);">20.93</td><td class="pvtTotal rowTotal" data-value="96.74" data-for="row1" style="background-color: rgb(255, 255, 255);">96.74</td></tr><tr><th class="pvtRowLabel" rowspan="2">Male</th><th class="pvtRowLabel" rowspan="1" colspan="2">No</th><td class="pvtVal row2 col0" data-value="5" style="background-color: rgb(255, 255, 255);">5.00</td><td class="pvtVal row2 col1" data-value="104.21000000000001" style="background-color: rgb(255, 59, 59);">104.21</td><td class="pvtVal row2 col2" data-value="133.96000000000004" style="background-color: rgb(255, 0, 0);">133.96</td><td class="pvtVal row2 col3" data-value="58.83" style="background-color: rgb(255, 149, 149);">58.83</td><td class="pvtTotal rowTotal" data-value="302" data-for="row2" style="background-color: rgb(255, 0, 0);">302.00</td></tr><tr><th class="pvtRowLabel" rowspan="1" colspan="2">Yes</th><td class="pvtVal row3 col0" data-value="21.93" style="background-color: rgb(255, 222, 222);">21.93</td><td class="pvtVal row3 col1" data-value="77.73999999999998" style="background-color: rgb(255, 111, 111);">77.74</td><td class="pvtVal row3 col2" data-value="52.82" style="background-color: rgb(255, 160, 160);">52.82</td><td class="pvtVal row3 col3" data-value="30.58" style="background-color: rgb(255, 204, 204);">30.58</td><td class="pvtTotal rowTotal" data-value="183.07" data-for="row3" style="background-color: rgb(255, 148, 148);">183.07</td></tr><tr><th class="pvtTotalLabel pvtColTotalLabel" colspan="3">Totals</th><td class="pvtTotal colTotal" data-value="51.96" data-for="col0" style="background-color: rgb(255, 255, 255);">51.96</td><td class="pvtTotal colTotal" data-value="260.4" data-for="col1" style="background-color: rgb(255, 0, 0);">260.40</td><td class="pvtTotal colTotal" data-value="247.39000000000007" data-for="col2" style="background-color: rgb(255, 16, 16);">247.39</td><td class="pvtTotal colTotal" data-value="171.83" data-for="col3" style="background-color: rgb(255, 108, 108);">171.83</td><td class="pvtGrandTotal" data-value="731.58">731.58</td></tr></tbody></table></div>
            <br>
            This page also uses prism.js for syntax highlighting.
        </li>
        <li>
            You can mark tags other than <progi>script</progi> with <progi>constexpr</progi> as well.
            In the above example, the box at the top is marked constexpr, so it isn't present in the output page.
            This can be used to differentiate original website from generated website:
            <prog class=" language-html">
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">constexpr</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
<span class="token selector">body</span> <span class="token punctuation">{</span>
    <span class="token property">border</span><span class="token punctuation">:</span> 2px solid red<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
            </prog>
        </li>
        <li>
            Client code in the page can signal the compiler to skip the current file by calling <progi>window._ConstexprJS_.abort(message)</progi>.
        </li>
        <li>
            In the original webpage, you'll see a console error when the code tries to call the compilation trigger function,
            since that function is injected by the compiler. You can add this snippet near the top to fix that error:

            <prog class=" language-js">
<span class="token operator">&lt;</span>script constexpr<span class="token operator">&gt;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>window<span class="token punctuation">.</span>_ConstexprJS_<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    window<span class="token punctuation">.</span>_ConstexprJS_ <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token function-variable function">compile</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function-variable function">abort</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
            </prog>
        </li>
        <li>
            There might be multiple rendering tasks running in your page. You can manage all those tasks using <a href="https://github.com/fctorial/fctorial.github.io.src/blob/master/static/js/constexpr/index.js">this</a>
            refcounting mechanism.

            All the tasks will call <progi>startLoading()</progi> when they begin loading, and <progi>endLoading()</progi>
            when they've finished loading. The compilation will be triggered when all the tasks have finished.
        </li>
        <li>
            You should keep all list data separate from the html in <a href="https://github.com/fctorial/fctorial.github.io.src/tree/master/collections">json files</a>.
            <progi>constexpr</progi> code in the html will fetch these json files and render the page using them.
            The directory containing this data should be excluded using <progi>--exclusions</progi> flag, so that the
            resources inside it aren't copied over.
        </li>
        <li>
            You can include dev utilites like <a href="https://github.com/fctorial/fctorial.github.io.src/blob/master/static/js/constexpr/nav.js#L19">this</a> in the
            original website. It reloads the page whenever it's focused. It won't be in the output since it's used as constexpr.
        </li>
        <li>
            This whole website is rendered using javascript and constexpr.js. Nothing other than the demo uses runtime javascript:
            <prog>
$ tokei -t=javascript
===============================================================================
Language            Files        Lines         Code     Comments       Blanks
===============================================================================
JavaScript              1            2            1            0            1
===============================================================================
Total                   1            2            1            0            1
===============================================================================
            </prog>
            The original sources can be found <a href="https://github.com/fctorial/fctorial.github.io.src">here</a>.
        </li>
    </ol>
</article>





<link rel="stylesheet" type="text/css" href="/static/css/pivot.css">




<style>
    ol li {
        margin: 2em 0;
    }
</style>

</body></html>