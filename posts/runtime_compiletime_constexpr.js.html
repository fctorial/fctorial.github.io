<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><link rel="icon" href="/favicon.ico" sizes="32x32" type="image/x-icon"><meta name="viewport" content="width=device-width, min-width=800"><link rel="stylesheet" href="/static/css/styles.css"><link rel="preconnect" href="https://fonts.gstatic.com"><link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;1,100;1,200;1,300;1,400;1,500;1,600;1,700&amp;family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&amp;display=swap" rel="stylesheet"><meta name="description" content="Some tips for organizing code when using constexpr.js, a static site generator which uses javascript for generating HTML"><meta name="keywords" content="constexpr.js"><title>Runtime/Compile time code separation with constexpr.js</title><link rel="stylesheet" href="/static/css/prism.css"></head><body>
<img class="bg" id="main_bg" src="/static/img/bg.jpg" alt="">










<div id="body_wrapper" class="first_body_wrapper"><header><nav><a href="/">
              HOME
          </a><a href="/projects.html">
              PROJECTS
          </a><a href="/tags.html">
              TAGS
          </a></nav><h1 id="main_title">Runtime/Compile time code separation with constexpr.js</h1><ul class="tags_list"><li><a class="tag_element" href="/tags/constexpr.js.html">constexpr.js</a></li></ul><div style="width: calc(100% - 2em); height: 5px; margin: 1em auto 0; border: solid black; border-width: 1px 0;"></div></header><article>
    <p>
        <a href="/posts/constexpr.js.html">constexpr.js</a> allows you to execute some of the javascript in your website
        before it is deployed. I'll refer to such javascript as <progi role="figure">constepxr</progi>. You can use constexpr code for
        programmatically generating HTML in your website.
    </p>
    <p>
        The constexpr code is stripped out by the compiler, so the runtime code must not depend on it. Hence, there has to
        be a clear boundary between the runtime code and compile time code. In this article I'll share some tips for
        managing code when building a site with constexpr.js. I'll be using <a href="/posts/intellij_logos.html">this</a>
        page as an example in this article. Try hovering over the images. The images list in this page is generated
        statically with constexpr.js but the background is being manipulated at runtime with javascript.<br>
        <a href="https://github.com/fctorial/fctorial.github.io.src/blob/master/posts/intellij_logos.html">Original page source</a><br>
        <a href="https://github.com/fctorial/fctorial.github.io/blob/master/posts/intellij_logos.html">Compiler output</a>
    </p>
    <p>
        Javascript execution in your website should be split into two phases. The compilation phase and the runtime
        phase. The first thing you should do when building a site is to write the compilation phase code. In the above
        example, it's the code that generates the images list, the background and the navbar. All the compilation phase
        code should be marked as <progi role="figure">constexpr</progi>.
    </p>
    <p>
        There should be a regular, non-constexpr method in your website which will bootstrap the runtime code execution.
        (<progi role="figure">initHover</progi> in the above example). Once the compilation phase code has finished rendering the page,
        it should append a script tag to the DOM that calls this method:
    </p>
        <prog class=" language-javascript" role="figure"><span class="token spread operator">...</span>
<span class="token keyword">const</span> init <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">createElement</span><span class="token punctuation">(</span><span class="token string">'script'</span><span class="token punctuation">)</span>
init<span class="token punctuation">.</span><span class="token property-access">innerText</span> <span class="token operator">=</span> <span class="token string">'initHover()'</span>
<span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span><span class="token string">'html'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">appendChild</span><span class="token punctuation">(</span>init<span class="token punctuation">)</span>
<span class="token spread operator">...</span></prog>
    <p>
        This will accomplish two things:
    </p>
    <ol>
        <li>
            Newly added script tags are executed immediately by the browser. So the<progi role="figure">initHover</progi> method will
            be called after the HTML structure has been generated in the original website.
        </li>
        <li>
            Since the constexpr code is stripped out before snapshotting the website, the output HTML will contain only
            three things:
            <ol>
                <li>Generated HTML</li>
                <li>Runtime bootstrap function <progi role="figure">initHover</progi></li>
                <li>A script tag that calls the bootstrap function</li>
            </ol>
        </li>
    </ol>
    <blockquote>
        See pages tagged with <a class="tag_element" href="/tags/constexpr.js.html">constexpr.js</a> for more guides.
    </blockquote>
</article><footer>
    <div class="links">
        <div class="social">
            <div class="footer-title">Share this page:</div>
            <a rel="noopener" title="twitter" class="svg-icon twitter" target="_blank" href="https://twitter.com/share?text=Runtime/Compile time code separation with constexpr.js&amp;url=https://fctorial.github.io/posts/runtime_compiletime_constexpr.js.html"></a>
            <a rel="noopener" title="facebook" class="svg-icon facebook" target="_blank" href="https://www.facebook.com/sharer.php?u=https://fctorial.github.io/posts/runtime_compiletime_constexpr.js.html"></a>
            <a rel="noopener" title="reddit" class="svg-icon reddit" target="_blank" href="https://www.reddit.com/submit?title=Runtime/Compile time code separation with constexpr.js&amp;url=https://fctorial.github.io/posts/runtime_compiletime_constexpr.js.html"></a>
        </div>
        <div class="social">
            <div class="footer-title">Contacts:</div>
            <a rel="noopener" title="github" href="https://github.com/fctorial" class="svg-icon github"></a>
            <a rel="noopener" title="twitter" href="https://twitter.com/fctorial1" class="svg-icon twitter"></a>
            <a rel="noopener" title="email" href="mailto:fctorial@gmail.com" class="svg-icon email"></a>
        </div>
    </div>

<a rel="noopener" class="discussion" target="_blank" href="https://www.reddit.com/r/fctorial/comments/me5f4s/runtimecompile_time_code_separation_with/">Join the discussion here</a></footer></div></body></html>