<!DOCTYPE html><html lang="en"><head>
    <title>Runtime/Compile time code separation with constexpr.js</title>
<meta charset="UTF-8"><link rel="icon" href="/favicon.ico" sizes="32x32" type="image/x-icon"><meta name="viewport" content="width=device-width, min-width=800"><link rel="stylesheet" href="/static/css/global_styles.css"><link rel="stylesheet" href="/static/css/prism.css"></head>
<body>
<img class="bg" id="main_bg" src="/static/img/bg.jpg"><nav><a href="/">
              HOME
          </a><a href="/projects.html">
              PROJECTS
          </a></nav><article>
    <header>
        <h3 id="main_title">Runtime/Compile time code separation with constexpr.js</h3>
    </header><div style="width: 100%; height: 5px; margin: 1em 0 2em; border: solid black; border-width: 1px 0;"></div>
    <p>
        <a href="/posts/constexpr.js.html">constexpr.js</a> is a static site generator. However, the sites generated with constexpr.js don't have to be
        completely javascript free. Try hovering over the images in <a href="/posts/intellij_logos.html">this</a> page.
        The html in this page is generated statically with constexpr.js but the background is being manipulated at runtime with javascript.
    </p>
    <p>
        The constexpr code used for generating html is stripped out during site generation, so the runtime code must not
        depend on it. So there has to be a clear boundary between the runtime code and compile time code. In this article
        I'll share some tips for managing code when building a site with constexpr.js.
    </p>
    <p>
        The first thing you should do when building a site is to write the html generation code. In the above example, it's
        the code that generates the images list, the background and the navbar.
        <br>
        The code for generating images list is kept in the html file itself since it does page specific stuff and the rest is
        kept in a file named <a href="https://github.com/fctorial/fctorial.github.io.src/blob/master/static/js/constexpr/renderer.js">renderer.js</a>,
        which contains site global theming, and it's included by every page on the site. If I want something to appear on every page
        on this site (A footer, syntax highlighting etc), this is where I'll add it.
    </p>
    <p>
        Constexpr javascript in the <a href="https://github.com/fctorial/fctorial.github.io.src/blob/master/posts/intellij_logos.html">html</a>
        also generates a <progi>fixed</progi> background image for each logo in the page, with initial opacity set to <progi>0</progi>.
        There's a non-constexpr function called <progi>initHover</progi> that sets up event handlers for the logo images, which just
        toggle the <progi>opacity</progi> value for the background images. This function is supposed to trigger the runtime javascript.
    </p>
    <p>
        Once the html generation code has done it's job, it appends a script tag that calls the initialization function
        right before it signals to the compiler that it has finished:
        <prog class=" language-javascript"><span class="token operator">...</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> init <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'script'</span><span class="token punctuation">)</span>
    init<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">'initHover()'</span>
    document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'html'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>init<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>finishLoading<span class="token punctuation">)</span></prog>
        Always add new script tags at the end of the document (or at least after the last script tag). This ensures that the
        resulting page state is what you would've gotten if you'd loaded a document containing the final HTML. Do not
        use <progi>defer</progi> attribute on script tags. Keep the javascript execution as predictable as possible.
    </p>
    <p>
        The <a href="https://github.com/fctorial/fctorial.github.io/blob/master/posts/intellij_logos.html">output HTML</a> will
        contain the generated list of images, a script tag defining the initialization function, and a script tag calling the
        initialization function. All the <em>compilation/generation</em> code will be stripped out.
    </p>
</article>





</body></html>